<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Ejecutar Lua en navegador con Fengari</title>
<script src="https://unpkg.com/fengari-web/dist/fengari-web.js"></script>
</head>
<body>
<h2>Lua en navegador con Fengari</h2>

<textarea id="codigoLua" cols="60" rows="10">
print("Hola desde Lua en navegador!")
</textarea><br/>

<button id="ejecutar">Ejecutar Lua</button>

<pre id="salida" style="background:#eee; padding:10px; border:1px solid #ccc; width:600px; height:150px; overflow:auto;"></pre>

<script>
  const { lua, lauxlib, lualib, to_luastring } = fengari;

  function ejecutarLua(codigo) {
    const L = lauxlib.luaL_newstate(); // crear nuevo estado Lua
    lualib.luaL_openlibs(L);            // abrir librerías estándar
    
    // Redefinir print para capturar salida y mostrar en pantalla
    lua.lua_pushjsfunction(L, function(L) {
      let n = lua.lua_gettop(L);
      let res = [];
      for (let i=1; i<=n; i++) {
        res.push(fengari.to_jsstring(lua.lua_tolstring(L, i)));
      }
      document.getElementById("salida").textContent += res.join("\t") + "\n";
      return 0;
    });
    lua.lua_setglobal(L, to_luastring("print"));

    // Ejecutar código Lua
    const status = lauxlib.luaL_loadstring(L, to_luastring(codigo));
    if (status === lua.LUA_OK) {
      lua.lua_pcall(L, 0, lua.LUA_MULTRET, 0);
    } else {
      const err = fengari.to_jsstring(lua.lua_tostring(L, -1));
      document.getElementById("salida").textContent += "Error: " + err + "\n";
    }
  }

  document.getElementById("ejecutar").onclick = () => {
    document.getElementById("salida").textContent = ""; // limpiar salida
    const codigo = document.getElementById("codigoLua").value;
    ejecutarLua(codigo);
  }
</script>

</body>
</html>
